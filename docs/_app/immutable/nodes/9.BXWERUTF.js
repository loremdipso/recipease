import{l as ne,d as re,t as ae,a as ie,s as oe}from"../chunks/CYIjoMr1.js";import{q as J,au as se,p as le,d as W,l as z,m as ue,av as _e,o as d,c as v,t as pe,i as n,a as fe,s as c,n as D,r as m}from"../chunks/DdW1EsoA.js";import{s as E}from"../chunks/CglLUYzN.js";import{s as ce,b as de,a as ve}from"../chunks/CkSXy_xo.js";import{a as me}from"../chunks/BCYYOsBJ.js";import{O as f,b as he,g as ge,s as be,k as N,l as T,c as xe,C as A,e as $e,L as G}from"../chunks/DmioJiEo.js";import{w as we,n as ke,j as ye,f as je,h as Me,a as Oe}from"../chunks/BfBYdUds.js";import{S as Re}from"../chunks/DIRDfxQS.js";function Q(t,s,l){if(t.multiple)return Pe(t,s);for(var _ of t.options){var u=h(_);if(se(u,s)){_.selected=!0;return}}(!l||s!==void 0)&&(t.selectedIndex=-1)}function qe(t,s){J(()=>{var l=new MutationObserver(()=>{var _=t.__value;Q(t,_)});return l.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{l.disconnect()}})}function Ce(t,s,l=s){var _=!0;ne(t,"change",u=>{var i=u?"[selected]":":checked",p;if(t.multiple)p=[].map.call(t.querySelectorAll(i),h);else{var g=t.querySelector(i)??t.querySelector("option:not([disabled])");p=g&&h(g)}l(p)}),J(()=>{var u=s();if(Q(t,u,_),_&&u===void 0){var i=t.querySelector(":checked");i!==null&&(u=h(i),l(u))}t.__value=u,_=!1}),qe(t)}function Pe(t,s){for(var l of t.options)l.selected=~s.indexOf(h(l))}function h(t){return"__value"in t?t.__value:t.value}var Se=async(t,s)=>{await we(n(s)),ke("Text copied to clipboard")},Ee=ae('<div class="card black flex-col gap1"><h2>Export</h2> <label>Output type: <select><option>Markdown checkboxes</option><option>Markdown list</option><option>Plain text</option></select></label> <div class="flex-row gap0_5 flex-wrap flex-start"><button class="blue rounded">Copy to clipboard</button> <!></div> <h3>Preview</h3> <pre class="svelte-13ppi9h"> </pre></div>');function Xe(t,s){le(s,!0);const[l,_]=ce(),u=()=>ve(Oe,"$all_recipes",l);let i=z(void 0);W(()=>{n(i)&&de(ye,n(i).name)});let p=d(()=>n(i)?xe(E(n(i)),E(u())):{errors:[],ingredients:[]}),g=d(()=>{var e;return[$("Unknown items",n(p).errors).join(`
`),$("Known items",n(p).ingredients).join(`
`),$("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),V=d(()=>{var e;return[w("Unknown items",n(p).errors).join(`
`),w("Known items",n(p).ingredients).join(`
`),w("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),Y=d(()=>{var e;return[k("Unknown items",n(p).errors).join(`
`),k("Known items",n(p).ingredients).join(`
`),k("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`
`).trim()}),x=z(ue(f.Markdown)),b=d(()=>Z(n(x)));function Z(e){switch(e){case f.Markdown:return n(g);case f.PlainText:return n(V);case f.Naked:return n(Y);default:return"ERROR"}}let I=!1;_e(()=>{K()}),me(()=>{K()}),W(()=>{n(i)&&n(i).id!=null&&he(E(n(i)))});function K(){I||(I=!0,(async()=>{let e=je("id");if(e!==null&&Me(e)){let a=Number(e);D(i,await ge(a,{include_recipes:!0}),!0),n(i)&&be(n(i).id)}})())}function $(e,a){if(!a)return[];let o=[`# ${e}
`];for(let r of a)N(r)?o.push(`${A} ${y(r)}`):T(r)?o.push(`${A} ${j(r)}`):o.push(`${A} ${r}`);return o}function w(e,a){if(!(a!=null&&a.length))return[];let o=[`# ${e}
`];for(let r of a)N(r)?o.push(`- ${y(r)}`):T(r)?o.push(`- ${j(r)}`):o.push(`- ${r}`);return o}function k(e,a){if(!(a!=null&&a.length))return[];let o=[];for(let r of a)N(r)?o.push(y(r)):T(r)?o.push(j(r)):o.push(`${r}`);return o}function y(e){let a=F(e.name),o=$e(e);return o!=="ERROR"?`${o} ${a}`:[a,...e.quantities.map(r=>r.recipe_count!==1?`(${r.ingredient_quantity} x${r.recipe_count})`:`(${r.ingredient_quantity})`)].join(" ")}function j(e){let a=F(e.text);return e.recipe_count!==1?`${a} x${e.recipe_count}`:a}function F(e){return e.startsWith(G)&&(e=e.substr(G.length)),e=e.replaceAll(`
`," ").replaceAll("  "," ").replaceAll("**",""),e}var M=Ee(),O=c(v(M),2),R=c(v(O)),q=v(R),L={},C=c(q),U={},X=c(C),B={};m(R),m(O);var P=c(O,2),S=v(P);S.__click=[Se,b];var ee=c(S,2);Re(ee,{with_text:!0,extra_classes:"blue rounded",onshare:async()=>{await navigator.share({title:"Shopping list",text:n(b)})}}),m(P);var H=c(P,4),te=v(H);m(H),m(M),pe(()=>{L!==(L=f.Markdown)&&(q.value=(q.__value=f.Markdown)??""),U!==(U=f.PlainText)&&(C.value=(C.__value=f.PlainText)??""),B!==(B=f.Naked)&&(X.value=(X.__value=f.Naked)??""),S.disabled=!n(b).length,oe(te,`        ${n(b)??""}
    `)}),Ce(R,()=>n(x),e=>D(x,e)),ie(t,M),fe(),_()}re(["click"]);export{Xe as component};
