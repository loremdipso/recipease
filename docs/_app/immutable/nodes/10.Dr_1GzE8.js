import{d as tt,t as u,a as l,c as te,s as A,b as _e}from"../chunks/Br7P6-nc.js";import{p as at,d as Ee,i as e,B as E,A as je,z as F,f as G,a as rt,s as i,c as r,r as a,C as ve,t as O,G as st}from"../chunks/CBx8egCH.js";import{s as de}from"../chunks/CVbmqFT_.js";import{i as g}from"../chunks/COUgnmWl.js";import{e as J,i as Q}from"../chunks/IIMqjkV9.js";import{r as ae,b as ue}from"../chunks/0KIouc5R.js";import{O as Be,b as it}from"../chunks/BEvkJWZC.js";import{s as lt,b as ot,a as nt}from"../chunks/CgSSeZ4p.js";import{g as ct,s as _t,b as vt,c as dt,f as ut,L as pt,e as pe}from"../chunks/1AdgqzQS.js";import{f as ft,h as mt,j as gt,a as ht}from"../chunks/DY5NW6g7.js";import{C as bt}from"../chunks/BRrMQLTx.js";import{M as fe}from"../chunks/B33Gqscv.js";import{P as kt}from"../chunks/Chl4sq6_.js";import{T as xt}from"../chunks/vU-L2Mcm.js";import{C as re}from"../chunks/Cl8xwoyb.js";import{R as wt}from"../chunks/DQdj1fTl.js";import{S as De}from"../chunks/DFSDZQDY.js";var yt=(v,o,d)=>{v.stopPropagation(),o(e(d).recipe_url)},Rt=u('<button class="flex-row vertically-centered"><div class="grow flex-row vertically-centered flex-start gap1"><!> <span class="left"> </span></div> <div> </div></button>'),$t=u("<div>None</div>"),Ct=u('<div class="list flex-col"><!> <!></div>'),St=(v,o)=>{e(o)&&(e(o).checked_items={})},Nt=(v,o,d)=>{e(o).checked_items[e(d).text]=v.target.checked},Ot=u('<span class="shrink blue rounded p0_5 ph0"> </span>'),Pt=(v,o,d)=>{o(e(d).recipe_url,e(d).text)},It=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow gap0_5"><!> <span class="grow"> </span> <button class="flex-row vertically-centered gap0_5 p0_5" title="Info" aria-label="Info"><!></button></div></label>'),At=u('<div class="list"></div>'),Et=(v,o,d)=>{e(o).checked_items[e(d).name]=v.target.checked},jt=(v,o,d)=>{o[e(d).name]=!o[e(d).name]},Bt=u('<button class="flex-row vertically-centered gap0_5 shrink mla" title="See sources" aria-label="See sources"><span> </span></button>'),Dt=(v,o,d)=>{o(e(d).recipe_url,e(d).original_line)},Kt=u('<button class="blue rounded p0_5 shrink flex-row vertically-centered gap0_5" title="See original line" aria-label="See original line"><!> <!></button>'),Lt=u('<div class="flex-row gap0_5 wrap flex-start"></div>'),Mt=u('<label class="selectable"><input type="checkbox"> <div class="flex-col grow"><div class="flex-row grow vertically-centered"><h2 class="grow"> </h2> <!></div> <!></div></label>'),Tt=u('<div class="list"></div>'),Ut=u('<div class="list"><div>No items yet</div></div>'),zt=(v,o,d)=>{e(o).checked_items[e(d)]=v.target.checked},Ft=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow"><span class="grow"> </span> <button class="shrink" title="Delete" aria-label="Delete"><!></button></div></label>'),Gt=(v,o)=>{v.key==="Enter"&&(v.stopPropagation(),o())},Ht=(v,o)=>{o()},Wt=u('<div class="list"><!> <div class="flex-row"><label class="flex-row grow gap1"><span>New item:</span> <input class="grow"></label> <button title="Add" aria-label="Add"><!></button></div></div>'),Xt=u('<div class="flex-col gap1"><div class="card black flex-col gap1"><!> <div class="flex-row gap0_5 wrap"><!> <!></div></div> <div class="card has-list flex-col gap1"><div class="flex-row vertically-centered"><h2 class="grow">Checklist <!></h2> <button class="disableable shrink p0">Reset checklist</button></div> <div class="full-width flex-col gap1"><!> <!> <!> <!></div></div></div>'),qt=u('<div class="card"><h1>ERROR: shopping list is missing</h1></div>'),Jt=(v,o)=>{v.stopPropagation(),E(o,null)},Qt=u('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),Vt=u("<!> <!> <!>",1);function ma(v,o){at(o,!0);const[d,Ke]=lt(),Le=()=>nt(ht,"$all_recipes",d);let t=F(void 0);Ee(()=>{e(t)&&ot(gt,e(t).name)});let L=ve(()=>e(t)?dt(de(e(t)),de(Le())):{errors:[],ingredients:[]}),me=ve(()=>{var s;return Object.values(((s=e(t))==null?void 0:s.checked_items)||{}).filter(p=>!!p).length}),ge=ve(()=>{var s;return(((s=e(t))==null?void 0:s.custom_items)||[]).length+e(L).errors.length+e(L).ingredients.length});Ee(()=>{e(t)&&e(t).id!=null&&e(t).id>=0&&vt(de(e(t)))});let he=F(!1);Me();function Me(){e(he)||(E(he,!0),(async()=>{let s=ft("id");if(s!==null&&mt(s)){let p=Number(s);E(t,await ct(p,{include_recipes:!0}),!0),e(t)&&_t(e(t).id)}})())}async function se(s,p){let j=await ut(s);j&&(E(Y,j,!0),E(ke,p,!0))}let ie=F(!1),V=F(!1),be=je({}),Y=F(null),ke=F(void 0),le=F(je([])),H=F(null);function xe(){e(H)&&e(t)&&(e(t).custom_items||(e(t).custom_items=[]),e(t).custom_items.push(e(H)),E(H,""))}function Te(s){if(e(t)){e(t).custom_items||(e(t).custom_items=[]);let p=e(t).custom_items.splice(s,1);p[0]&&delete e(t).checked_items[p[0]]}}function Yt(s){return s}var we=Vt(),ye=G(we);{var Ue=s=>{var p=Xt(),j=r(p),M=r(j);re(M,{title:"Source recipes",start_collapsed:!0,content:B=>{var P=Ct(),x=r(P);{var T=f=>{var w=te(),m=G(w);J(m,17,()=>e(t).items,Q,(_,h)=>{var y=Rt();y.__click=[yt,se,h];var C=r(y),D=r(C);fe(D);var S=i(D,2),N=r(S,!0);a(S),a(C);var R=i(C,2),U=r(R,!0);a(R),a(y),O(()=>{var b;A(N,((b=e(h).recipe)==null?void 0:b.title)||"<UNKNOWN>"),A(U,e(h).quantity)}),l(_,y)}),l(f,w)};g(x,f=>{e(t)&&f(T)})}var n=i(x,2);{var I=f=>{var w=$t();l(f,w)};g(n,f=>{var w;(w=e(t))!=null&&w.items.length||f(I)})}a(P),l(B,P)}});var K=i(M,2),W=r(K);De(W,{text:"Show calculations",get checked(){return e(ie)},onchange:c=>{E(ie,c,!0)}});var Z=i(W,2);De(Z,{text:"Hide checked",get checked(){return e(V)},onchange:c=>{E(V,c,!0)}}),a(K),a(j);var ee=i(j,2),oe=r(ee),ne=r(oe),We=i(r(ne));{var Xe=c=>{var B=_e();O(()=>A(B,`(${e(me)??""} / ${e(ge)??""})`)),l(c,B)};g(We,c=>{e(ge)&&c(Xe)})}a(ne);var $e=i(ne,2);$e.__click=[St,t],a(oe);var Ce=i(oe,2),Se=r(Ce);{var qe=c=>{re(c,{title:"Unknown Ingredients",content:P=>{var x=At();J(x,21,()=>e(L).errors,Q,(T,n)=>{var I=te(),f=G(I);{var w=m=>{var _=It(),h=r(_);ae(h),h.__change=[Nt,t,n];var y=i(h,2),C=r(y);{var D=b=>{var $=Ot(),k=r($);a($),O(z=>A(k,`x${z??""}`),[()=>e(n).recipe_count]),l(b,$)};g(C,b=>{e(n).recipe_count!==1&&b(D)})}var S=i(C,2),N=r(S,!0);a(S);var R=i(S,2);R.__click=[Pt,se,n];var U=r(R);fe(U),a(R),a(y),a(_),O(b=>{ue(h,e(t).checked_items[e(n).text]),A(N,b)},[()=>e(n).text.replaceAll("**","").replaceAll(/\([^\)]+\)/g,"").replace(pt,"").replace(/, .*/,"").trim()]),l(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).text]))&&m(w)})}l(T,I)}),a(x),l(P,x)}})};g(Se,c=>{e(L).errors.length&&c(qe)})}var Ne=i(Se,2);{var Je=c=>{re(c,{title:"Known Ingredients",content:P=>{var x=Tt();J(x,21,()=>e(L).ingredients,Q,(T,n)=>{var I=te(),f=G(I);{var w=m=>{var _=Mt(),h=r(_);ae(h),h.__change=[Et,t,n];var y=i(h,2),C=r(y),D=r(C),S=r(D,!0);a(D);var N=i(D,2);{var R=$=>{var k=Bt();k.__click=[jt,be,n];var z=r(k),X=r(z,!0);a(z),a(k),O(q=>A(X,q),[()=>pe(e(n))]),l($,k)};g(N,$=>{pe(e(n))!=="ERROR"&&$(R)})}a(C);var U=i(C,2);{var b=$=>{var k=Lt();J(k,21,()=>e(n).quantities,Q,(z,X)=>{var q=Kt();q.__click=[Dt,se,X];var Pe=r(q);fe(Pe);var Ie=i(Pe),Ye=i(Ie);{var Ze=ce=>{var Ae=_e();O(et=>A(Ae,`x${et??""}`),[()=>e(X).recipe_count]),l(ce,Ae)};g(Ye,ce=>{e(X).recipe_count!==1&&ce(Ze)})}a(q),O(()=>A(Ie,` ${e(X).ingredient_quantity??""} `)),l(z,q)}),a(k),l($,k)};g(U,$=>{(e(ie)||be[e(n).name]||pe(e(n))==="ERROR")&&$(b)})}a(y),a(_),O(()=>{ue(h,e(t).checked_items[e(n).name]),A(S,e(n).name)}),l(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).name]))&&m(w)})}l(T,I)}),a(x),l(P,x)}})};g(Ne,c=>{e(L).ingredients.length&&c(Je)})}var Oe=i(Ne,2);{var Qe=c=>{var B=Ut();l(c,B)};g(Oe,c=>{!e(L).ingredients.length&&!e(L).errors.length&&c(Qe)})}var Ve=i(Oe,2);re(Ve,{title:"Custom items",content:B=>{var P=Wt(),x=r(P);J(x,17,()=>{var m;return((m=e(t))==null?void 0:m.custom_items)||[]},Q,(m,_,h)=>{var y=te(),C=G(y);{var D=S=>{var N=Ft(),R=r(N);ae(R),R.__change=[zt,t,_];var U=i(R,2),b=r(U),$=r(b,!0);a(b);var k=i(b,2);k.__click=()=>{Te(h)};var z=r(k);xt(z),a(k),a(U),a(N),O(()=>{ue(R,e(t).checked_items[e(_)]),A($,e(_))}),l(S,N)};g(C,S=>{var N;(!e(V)||!((N=e(t))!=null&&N.checked_items[e(_)]))&&S(D)})}l(m,y)});var T=i(x,2),n=r(T),I=i(r(n),2);ae(I),I.__keydown=[Gt,xe],a(n);var f=i(n,2);f.__click=[Ht,xe];var w=r(f);kt(w),a(f),a(T),a(P),O(()=>f.disabled=!e(H)),it(I,()=>e(H),m=>E(H,m)),l(B,P)}}),a(Ce),a(ee),a(p),O(()=>$e.disabled=!e(me)),l(s,p)},ze=s=>{var p=qt();l(s,p)};g(ye,s=>{e(t)?s(Ue):s(ze,!1)})}var Re=i(ye,2);{var Fe=s=>{Be(s,{click:()=>{E(Y,null)},content:j=>{var M=Qt(),K=G(M);K.__click=[Jt,Y];var W=r(K);bt(W),a(K);var Z=i(K,2);wt(Z,{get recipe(){return e(Y)},get line_to_focus(){return e(ke)},show_colors:!0}),l(j,M)},$$slots:{content:!0}})};g(Re,s=>{e(Y)&&s(Fe)})}var Ge=i(Re,2);{var He=s=>{Be(s,{click:()=>{E(le,[],!0)},content:j=>{var M=te(),K=G(M);J(K,17,()=>e(le),Q,(W,Z)=>{st();var ee=_e();O(()=>A(ee,e(Z))),l(W,ee)}),l(j,M)},$$slots:{content:!0}})};g(Ge,s=>{e(le).length&&s(He)})}l(v,we),rt(),Ke()}tt(["click","change","keydown"]);export{ma as component};
