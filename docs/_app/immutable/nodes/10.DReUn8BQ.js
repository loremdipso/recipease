import{d as tt,t as d,a as i,c as te,s as A,b as ve}from"../chunks/DwgEjbxA.js";import{p as at,d as Me,z as de,at as rt,A as z,f as F,a as st,s as l,i as e,B,c as r,r as t,C as ue,t as O,G as lt}from"../chunks/CaVnAIw_.js";import{s as je}from"../chunks/Cxt0cju3.js";import{i as h}from"../chunks/C_eFljRt.js";import{e as J,i as Q}from"../chunks/BKNwm1Mp.js";import{r as ae,b as pe}from"../chunks/DEpH4IwR.js";import{O as Be,b as it}from"../chunks/CBHtq2v6.js";import{s as ot,b as nt}from"../chunks/BBhsiMei.js";import{a as ct}from"../chunks/B5Z8z8F4.js";import{g as _t,j as vt,k as dt,m as ut,o as pt,s as ft,p as mt,q as gt,r as De,L as ht,t as fe}from"../chunks/BRz5OOaA.js";import{C as bt}from"../chunks/_TEUyO84.js";import{M as me}from"../chunks/C_emGiiq.js";import{P as kt}from"../chunks/CEr657pl.js";import{T as xt}from"../chunks/CrVo5Hep.js";import{C as re}from"../chunks/Csmrc7xE.js";import{R as wt}from"../chunks/BHJLMLFI.js";import{S as Ke}from"../chunks/BohLq3Gq.js";var yt=(v,o,u)=>{v.stopPropagation(),o(e(u).recipe_url)},Rt=d('<button class="flex-row vertically-centered"><div class="grow flex-row vertically-centered flex-start gap1"><!> <span class="left"> </span></div> <div> </div></button>'),$t=d("<div>None</div>"),Ct=d('<div class="list flex-col"><!> <!></div>'),Nt=(v,o)=>{e(o)&&(e(o).checked_items={})},St=(v,o,u)=>{e(o).checked_items[e(u).text]=v.target.checked},Ot=d('<span class="shrink blue rounded p0_5 ph0"> </span>'),Pt=(v,o,u)=>{o(e(u).recipe_url,e(u).text)},It=d('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow gap0_5"><!> <span class="grow"> </span> <button class="flex-row vertically-centered gap0_5 p0_5" title="Info" aria-label="Info"><!></button></div></label>'),At=d('<div class="list"></div>'),Et=(v,o,u)=>{e(o).checked_items[e(u).name]=v.target.checked},Mt=(v,o,u)=>{o[e(u).name]=!o[e(u).name]},jt=d('<button class="flex-row vertically-centered gap0_5 shrink mla" title="See sources" aria-label="See sources"><span> </span></button>'),Bt=(v,o,u)=>{o(e(u).recipe_url,e(u).original_line)},Dt=d('<button class="blue rounded p0_5 shrink flex-row vertically-centered gap0_5" title="See original line" aria-label="See original line"><!> <!></button>'),Kt=d('<div class="flex-row gap0_5 wrap flex-start"></div>'),Lt=d('<label class="selectable"><input type="checkbox"> <div class="flex-col grow"><div class="flex-row grow vertically-centered"><h2 class="grow"> </h2> <!></div> <!></div></label>'),Tt=d('<div class="list"></div>'),Ut=d('<div class="list"><div>No items yet</div></div>'),qt=(v,o,u)=>{e(o).checked_items[e(u)]=v.target.checked},zt=d('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow"><span class="grow"> </span> <button class="shrink" title="Delete" aria-label="Delete"><!></button></div></label>'),Ft=(v,o)=>{v.key==="Enter"&&(v.stopPropagation(),o())},Gt=(v,o)=>{o()},Ht=d('<div class="list"><!> <div class="flex-row"><label class="flex-row grow gap1"><span>New item:</span> <input class="grow"></label> <button title="Add" aria-label="Add"><!></button></div></div>'),Wt=d('<div class="flex-col gap1"><div class="card black flex-col gap1"><!> <div class="flex-row gap0_5 wrap"><!> <!></div></div> <div class="card has-list flex-col gap1"><div class="flex-row vertically-centered"><h2 class="grow">Checklist <!></h2> <button class="disableable shrink p0">Reset checklist</button></div> <div class="full-width flex-col gap1"><!> <!> <!> <!></div></div></div>'),Xt=d('<div class="card"><h1>ERROR: shopping list is missing</h1></div>'),Jt=(v,o)=>{v.stopPropagation(),B(o,null)},Qt=d('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),Vt=d("<!> <!> <!>",1);function ma(v,o){at(o,!0);const[u,Le]=ot();let a=z(null);Me(()=>{e(a)&&nt(vt,e(a).name)});let se=de(_t().reverse()),K=ue(()=>e(a)?gt(je(e(a)),je(se)):{errors:[],ingredients:[]}),ge=ue(()=>{var s;return Object.values(((s=e(a))==null?void 0:s.checked_items)||{}).filter(p=>!!p).length}),he=ue(()=>{var s;return(((s=e(a))==null?void 0:s.custom_items)||[]).length+e(K).errors.length+e(K).ingredients.length});rt(()=>{be()}),ct(()=>{be()}),Me(()=>{e(a)&&e(a).id>=0&&dt(e(a))});function be(){if(e(a))return;let s=ut("id");if(s!==null&&pt(s)){let p=Number(s);ft(p),B(a,mt(p),!0)}}function le(s,p){let E=De(s,se);E&&(B(Y,E,!0),B(xe,p,!0))}let ie=z(!1),V=z(!1),ke=de({}),Y=z(null),xe=z(void 0),oe=z(de([])),G=z(null);function we(){e(G)&&e(a)&&(e(a).custom_items||(e(a).custom_items=[]),e(a).custom_items.push(e(G)),B(G,""))}function Te(s){if(e(a)){e(a).custom_items||(e(a).custom_items=[]);let p=e(a).custom_items.splice(s,1);p[0]&&delete e(a).checked_items[p[0]]}}function Yt(s){return s}var ye=Vt(),Re=F(ye);{var Ue=s=>{var p=Wt(),E=r(p),L=r(E);re(L,{title:"Source recipes",start_collapsed:!0,content:M=>{var P=Ct(),x=r(P);{var T=f=>{var w=te(),m=F(w);J(m,17,()=>e(a).items,Q,(_,b)=>{var y=Rt();y.__click=[yt,le,b];var C=r(y),j=r(C);me(j);var N=l(j,2),S=r(N,!0);t(N),t(C);var R=l(C,2),U=r(R,!0);t(R),t(y),O(g=>{A(S,g),A(U,e(b).quantity)},[()=>{var g;return((g=De(e(b).recipe_url,se))==null?void 0:g.title)||"<UNKNOWN>"}]),i(_,y)}),i(f,w)};h(x,f=>{e(a)&&f(T)})}var n=l(x,2);{var I=f=>{var w=$t();i(f,w)};h(n,f=>{var w;(w=e(a))!=null&&w.items.length||f(I)})}t(P),i(M,P)}});var D=l(L,2),H=r(D);Ke(H,{text:"Show calculations",get checked(){return e(ie)},onchange:c=>{B(ie,c,!0)}});var Z=l(H,2);Ke(Z,{text:"Hide checked",get checked(){return e(V)},onchange:c=>{B(V,c,!0)}}),t(D),t(E);var ee=l(E,2),ne=r(ee),ce=r(ne),He=l(r(ce));{var We=c=>{var M=ve();O(()=>A(M,`(${e(ge)??""} / ${e(he)??""})`)),i(c,M)};h(He,c=>{e(he)&&c(We)})}t(ce);var Ce=l(ce,2);Ce.__click=[Nt,a],t(ne);var Ne=l(ne,2),Se=r(Ne);{var Xe=c=>{re(c,{title:"Unknown Ingredients",content:P=>{var x=At();J(x,21,()=>e(K).errors,Q,(T,n)=>{var I=te(),f=F(I);{var w=m=>{var _=It(),b=r(_);ae(b),b.__change=[St,a,n];var y=l(b,2),C=r(y);{var j=g=>{var $=Ot(),k=r($);t($),O(q=>A(k,`x${q??""}`),[()=>e(n).recipe_count]),i(g,$)};h(C,g=>{e(n).recipe_count!==1&&g(j)})}var N=l(C,2),S=r(N,!0);t(N);var R=l(N,2);R.__click=[Pt,le,n];var U=r(R);me(U),t(R),t(y),t(_),O(g=>{pe(b,e(a).checked_items[e(n).text]),A(S,g)},[()=>e(n).text.replaceAll("**","").replaceAll(/\([^\)]+\)/g,"").replace(ht,"").replace(/, .*/,"").trim()]),i(m,_)};h(f,m=>{var _;(!e(V)||!((_=e(a))!=null&&_.checked_items[e(n).text]))&&m(w)})}i(T,I)}),t(x),i(P,x)}})};h(Se,c=>{e(K).errors.length&&c(Xe)})}var Oe=l(Se,2);{var Je=c=>{re(c,{title:"Known Ingredients",content:P=>{var x=Tt();J(x,21,()=>e(K).ingredients,Q,(T,n)=>{var I=te(),f=F(I);{var w=m=>{var _=Lt(),b=r(_);ae(b),b.__change=[Et,a,n];var y=l(b,2),C=r(y),j=r(C),N=r(j,!0);t(j);var S=l(j,2);{var R=$=>{var k=jt();k.__click=[Mt,ke,n];var q=r(k),W=r(q,!0);t(q),t(k),O(X=>A(W,X),[()=>fe(e(n))]),i($,k)};h(S,$=>{fe(e(n))!=="ERROR"&&$(R)})}t(C);var U=l(C,2);{var g=$=>{var k=Kt();J(k,21,()=>e(n).quantities,Q,(q,W)=>{var X=Dt();X.__click=[Bt,le,W];var Ie=r(X);me(Ie);var Ae=l(Ie),Ye=l(Ae);{var Ze=_e=>{var Ee=ve();O(et=>A(Ee,`x${et??""}`),[()=>e(W).recipe_count]),i(_e,Ee)};h(Ye,_e=>{e(W).recipe_count!==1&&_e(Ze)})}t(X),O(()=>A(Ae,` ${e(W).ingredient_quantity??""} `)),i(q,X)}),t(k),i($,k)};h(U,$=>{(e(ie)||ke[e(n).name]||fe(e(n))==="ERROR")&&$(g)})}t(y),t(_),O(()=>{pe(b,e(a).checked_items[e(n).name]),A(N,e(n).name)}),i(m,_)};h(f,m=>{var _;(!e(V)||!((_=e(a))!=null&&_.checked_items[e(n).name]))&&m(w)})}i(T,I)}),t(x),i(P,x)}})};h(Oe,c=>{e(K).ingredients.length&&c(Je)})}var Pe=l(Oe,2);{var Qe=c=>{var M=Ut();i(c,M)};h(Pe,c=>{!e(K).ingredients.length&&!e(K).errors.length&&c(Qe)})}var Ve=l(Pe,2);re(Ve,{title:"Custom items",content:M=>{var P=Ht(),x=r(P);J(x,17,()=>{var m;return((m=e(a))==null?void 0:m.custom_items)||[]},Q,(m,_,b)=>{var y=te(),C=F(y);{var j=N=>{var S=zt(),R=r(S);ae(R),R.__change=[qt,a,_];var U=l(R,2),g=r(U),$=r(g,!0);t(g);var k=l(g,2);k.__click=()=>{Te(b)};var q=r(k);xt(q),t(k),t(U),t(S),O(()=>{pe(R,e(a).checked_items[e(_)]),A($,e(_))}),i(N,S)};h(C,N=>{var S;(!e(V)||!((S=e(a))!=null&&S.checked_items[e(_)]))&&N(j)})}i(m,y)});var T=l(x,2),n=r(T),I=l(r(n),2);ae(I),I.__keydown=[Ft,we],t(n);var f=l(n,2);f.__click=[Gt,we];var w=r(f);kt(w),t(f),t(T),t(P),O(()=>f.disabled=!e(G)),it(I,()=>e(G),m=>B(G,m)),i(M,P)}}),t(Ne),t(ee),t(p),O(()=>Ce.disabled=!e(ge)),i(s,p)},qe=s=>{var p=Xt();i(s,p)};h(Re,s=>{e(a)?s(Ue):s(qe,!1)})}var $e=l(Re,2);{var ze=s=>{Be(s,{click:()=>{B(Y,null)},content:E=>{var L=Qt(),D=F(L);D.__click=[Jt,Y];var H=r(D);bt(H),t(D);var Z=l(D,2);wt(Z,{get recipe(){return e(Y)},get line_to_focus(){return e(xe)},show_colors:!0}),i(E,L)},$$slots:{content:!0}})};h($e,s=>{e(Y)&&s(ze)})}var Fe=l($e,2);{var Ge=s=>{Be(s,{click:()=>{B(oe,[],!0)},content:E=>{var L=te(),D=F(L);J(D,17,()=>e(oe),Q,(H,Z)=>{lt();var ee=ve();O(()=>A(ee,e(Z))),i(H,ee)}),i(E,L)},$$slots:{content:!0}})};h(Fe,s=>{e(oe).length&&s(Ge)})}i(v,ye),st(),Le()}tt(["click","change","keydown"]);export{ma as component};
