import{l as ne,d as re,t as ae,a as ie,s as oe}from"../chunks/DwgEjbxA.js";import{D as J,ay as se,p as le,d as X,z as D,A as z,at as ue,C as d,c as v,t as _e,i as n,a as pe,s as c,B as H,r as m}from"../chunks/CaVnAIw_.js";import{s as W}from"../chunks/Cxt0cju3.js";import{s as fe,b as ce}from"../chunks/BBhsiMei.js";import{a as de}from"../chunks/B5Z8z8F4.js";import{g as ve,O as p,B as me,n as he,j as ge,k as be,m as xe,o as ke,s as $e,p as we,C as S,D as A,q as ye,E as N,t as je,L as G}from"../chunks/BRz5OOaA.js";import{S as Ce}from"../chunks/poKMpjBg.js";function Q(t,s,l){if(t.multiple)return Re(t,s);for(var u of t.options){var r=h(u);if(se(r,s)){u.selected=!0;return}}(!l||s!==void 0)&&(t.selectedIndex=-1)}function Me(t,s){J(()=>{var l=new MutationObserver(()=>{var u=t.__value;Q(t,u)});return l.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{l.disconnect()}})}function Oe(t,s,l=s){var u=!0;ne(t,"change",r=>{var f=r?"[selected]":":checked",_;if(t.multiple)_=[].map.call(t.querySelectorAll(f),h);else{var g=t.querySelector(f)??t.querySelector("option:not([disabled])");_=g&&h(g)}l(_)}),J(()=>{var r=s();if(Q(t,r,u),u&&r===void 0){var f=t.querySelector(":checked");f!==null&&(r=h(f),l(r))}t.__value=r,u=!1}),Me(t)}function Re(t,s){for(var l of t.options)l.selected=~s.indexOf(h(l))}function h(t){return"__value"in t?t.__value:t.value}var qe=async(t,s)=>{await me(n(s)),he("Text copied to clipboard")},Ee=ae('<div class="card black flex-col gap1"><h2>Export</h2> <label>Output type: <select><option>Markdown checkboxes</option><option>Markdown list</option><option>Plain text</option></select></label> <div class="flex-row gap0_5 flex-wrap flex-start"><button class="blue rounded">Copy to clipboard</button> <!></div> <h3>Preview</h3> <pre class="svelte-13ppi9h"> </pre></div>');function Ke(t,s){le(s,!0);const[l,u]=fe();let r=z(null);X(()=>{n(r)&&ce(ge,n(r).name)});let f=D(ve().reverse()),_=d(()=>n(r)?ye(W(n(r)),W(f)):{errors:[],ingredients:[]}),g=d(()=>{var e;return[k("Unknown items",n(_).errors).join(`
`),k("Known items",n(_).ingredients).join(`
`),k("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),V=d(()=>{var e;return[$("Unknown items",n(_).errors).join(`
`),$("Known items",n(_).ingredients).join(`
`),$("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),Y=d(()=>{var e;return[w("Unknown items",n(_).errors).join(`
`),w("Known items",n(_).ingredients).join(`
`),w("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`
`).trim()}),x=z(D(p.Markdown)),b=d(()=>Z(n(x)));function Z(e){switch(e){case p.Markdown:return n(g);case p.PlainText:return n(V);case p.Naked:return n(Y);default:return"ERROR"}}ue(()=>{T()}),de(()=>{T()}),X(()=>{n(r)&&n(r).id>=0&&be(n(r))});function T(){if(n(r))return;let e=xe("id");if(e!==null&&ke(e)){let i=Number(e);$e(i),H(r,we(i),!0)}}function k(e,i){if(!i)return[];let o=[`# ${e}
`];for(let a of i)S(a)?o.push(`${N} ${y(a)}`):A(a)?o.push(`${N} ${j(a)}`):o.push(`${N} ${a}`);return o}function $(e,i){if(!(i!=null&&i.length))return[];let o=[`# ${e}
`];for(let a of i)S(a)?o.push(`- ${y(a)}`):A(a)?o.push(`- ${j(a)}`):o.push(`- ${a}`);return o}function w(e,i){if(!(i!=null&&i.length))return[];let o=[];for(let a of i)S(a)?o.push(y(a)):A(a)?o.push(j(a)):o.push(`${a}`);return o}function y(e){let i=B(e.name),o=je(e);return o!=="ERROR"?`${o} ${i}`:[i,...e.quantities.map(a=>a.recipe_count!==1?`(${a.ingredient_quantity} x${a.recipe_count})`:`(${a.ingredient_quantity})`)].join(" ")}function j(e){let i=B(e.text);return e.recipe_count!==1?`${i} x${e.recipe_count}`:i}function B(e){return e.startsWith(G)&&(e=e.substr(G.length)),e=e.replaceAll(`
`," ").replaceAll("  "," ").replaceAll("**",""),e}var C=Ee(),M=c(v(C),2),O=c(v(M)),R=v(O),I={},q=c(R),K={},F=c(q),L={};m(O),m(M);var E=c(M,2),P=v(E);P.__click=[qe,b];var ee=c(P,2);Ce(ee,{with_text:!0,extra_classes:"blue rounded",onshare:async()=>{await navigator.share({title:"Shopping list",text:n(b)})}}),m(E);var U=c(E,4),te=v(U);m(U),m(C),_e(()=>{I!==(I=p.Markdown)&&(R.value=(R.__value=p.Markdown)??""),K!==(K=p.PlainText)&&(q.value=(q.__value=p.PlainText)??""),L!==(L=p.Naked)&&(F.value=(F.__value=p.Naked)??""),P.disabled=!n(b).length,oe(te,`        ${n(b)??""}
    `)}),Oe(O,()=>n(x),e=>H(x,e)),ie(t,C),pe(),u()}re(["click"]);export{Ke as component};
