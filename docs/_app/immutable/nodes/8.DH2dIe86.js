import{n as bt,a as w,d as gt,t as F,s as I}from"../chunks/CYIjoMr1.js";import{p as ht,l as b,m as J,i as t,n as p,d as kt,f as K,c as n,o as yt,s as c,a as xt,x as j,r as s,t as wt}from"../chunks/DdW1EsoA.js";import{s as Q}from"../chunks/CglLUYzN.js";import{i as $t}from"../chunks/xsFzECmQ.js";import{e as Ct}from"../chunks/DWk5ghVn.js";import{s as Rt}from"../chunks/B7XJn2s4.js";import{t as Pt,s as St}from"../chunks/DQ6ywEsN.js";import{b as At,s as Mt,a as U}from"../chunks/CkSXy_xo.js";import"../chunks/BCYYOsBJ.js";import{j as qt,s as V,g as jt,a as Dt,b as Ft}from"../chunks/DmioJiEo.js";import{j as D,f as Ot,s as Lt,k as Nt,h as Tt,e as Bt,a as Yt}from"../chunks/BfBYdUds.js";import{C as zt}from"../chunks/YJ_dkEMD.js";import{M as Et}from"../chunks/D3fA0VwG.js";import"../chunks/mJewewNG.js";import{P as Gt}from"../chunks/CRXheolD.js";import{R as W}from"../chunks/Difl6JaO.js";import{S as Ht}from"../chunks/C19GrMxj.js";import{T as It}from"../chunks/AmogBFoe.js";import{A as Jt}from"../chunks/MAbwEkBc.js";import{O as Kt}from"../chunks/Cg7dEFf2.js";import{R as Qt}from"../chunks/DCSRILoa.js";import{R as Ut}from"../chunks/55SrSJZN.js";var Vt=bt('<svg viewBox="0 -12 32 32" width="16px" height="16px" style="min-width: 16px" fill="#ffffff"><g transform="translate(-414.000000, -1049.000000)" fill="#ffffff"><path d="M442,1049 L418,1049 C415.791,1049 414,1050.79 414,1053 C414,1055.21 415.791,1057 418,1057 L442,1057 C444.209,1057 446,1055.21 446,1053 C446,1050.79 444.209,1049 442,1049"></path></g></svg>');function Wt(o){var r=Vt();w(o,r)}function Xt(o,r){p(r,{},!0)}var Zt=(o,r)=>{Dt(t(r).id),Bt("/shopping-lists")},te=(o,r,d)=>{o.stopPropagation(),p(r,t(d),!0)},ee=(o,r,d)=>{o.stopPropagation(),r(t(d))},ae=(o,r,d)=>{o.stopPropagation(),r(t(d))},re=(o,r,d)=>{o.stopPropagation(),r(t(d),.5)},ie=(o,r,d)=>{o.stopPropagation(),r(t(d),0)},se=F('<div><button class="grow vertically-centered gap1 white-text" title="See preview" aria-label="See preview"><!> <h2> </h2></button> <div class="shrink flex-col centered"><div class="shrink vertically-centered"><button title="Add to list" aria-label="Add to list"><!></button> <b title="Count" aria-label="Count"> </b> <button title="Add to list" aria-label="Add to list"><!></button></div> <div class="shrink vertically-centered justify-center"><button title="Make a half batch" aria-label="Make a half batch">Â½</button> <button title="Reset" aria-label="Reset"><!></button></div></div></div>'),oe=(o,r)=>{o.stopPropagation(),p(r,null)},le=F('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),ne=F('<div class="card has-list gap1 flex-col pt0"><div class="flex-row wrap gap1 p0 pt0_5 flex-end"><button class="blue rounded icon-button ph0"><!> Reset</button> <button class="red rounded icon-button p0_5"><!> Delete list</button> <h3 class="vertically-centered rounded ph0 icon-button"><!> Autosaved</h3></div> <div class="rounded-bottom black p0_5 pt2"><!></div> <div class="list"></div></div> <!> <!>',1);function qe(o,r){ht(r,!0);const[d,X]=Mt(),O=()=>U(D,"$current_list_name",d),Z=()=>U(Yt,"$all_recipes",d);D.set(tt());function tt(){const e=new Date,a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0");return`${l}-${_}-${a} list`}let $=b(J([])),i=b(J({})),f=b(null),v=b(void 0),m=yt(()=>({id:t(v),name:O()||"",items:at(),checked_items:{}})),L=b(!1);et();async function et(){if(t(L))return;p(L,!0);let e=Ot("id");if(Number(e)===-1)p(v,await qt(Q(t(m))),!0),V(t(v)),t(v)!=null?Lt("id",t(v).toString()):Nt("id");else if(Tt(e)){let a=Number(e),l=await jt(a);if(l){V(t(v)),p(i,{},!0),At(D,l.name);for(let _ of l.items)t(i)[_.recipe_url]?t(i)[_.recipe_url]+=_.quantity:t(i)[_.recipe_url]=_.quantity;p(v,l.id,!0)}}}kt(()=>{O()&&t(m).id!=null&&t(m).id>=0&&Ft(Q(t(m)))});function at(){let e=[];for(let a of Object.keys(t(i)))for(let l of Z())if(l.url===a){e.push({recipe_url:l.url,quantity:t(i)[a]});break}return e}function rt(e,a){a<=0?delete t(i)[e.url]:t(i)[e.url]=a}function N(e,a=1){t(i)[e.url]?t(i)[e.url]+=a:t(i)[e.url]=a}function it(e){t(i)[e.url]&&(t(i)[e.url]-=1,t(i)[e.url]<=0&&delete t(i)[e.url])}var T=ne(),C=K(T),R=n(C),g=n(R);g.__click=[Xt,i];var st=n(g);W(st),j(),s(g);var h=c(g,2);h.__click=[Zt,m];var ot=n(h);It(ot),j(),s(h);var B=c(h,2),lt=n(B);Ht(lt),j(),s(B),s(R);var P=c(R,2),nt=n(P);Qt(nt,{get recipes(){return t($)},set recipes(e){p($,e,!0)}}),s(P);var Y=c(P,2);Ct(Y,21,()=>t($),e=>e.url,(e,a)=>{var l=se();let _;var u=n(l);u.__click=[te,f,a];var k=n(u);Et(k);var y=c(k,2),dt=n(y,!0);s(y),s(u);var E=c(u,2),S=n(E),x=n(S);x.__click=[ee,it,a];var ut=n(x);Wt(ut),s(x);var A=c(x,2),pt=n(A,!0);s(A);var M=c(A,2);M.__click=[ae,N,a];var vt=n(M);Gt(vt),s(M),s(S);var G=c(S,2),H=n(G);H.__click=[re,N,a];var q=c(H,2);q.__click=[ie,rt,a];var ft=n(q);W(ft),s(q),s(G),s(E),s(l),wt(mt=>{_=Rt(l,1,"flex-row flex-end vertically-centered",null,_,mt),I(dt,t(a).title||"<missing title>"),I(pt,t(i)[t(a).url]||0)},[()=>({selected:(t(i)[t(a).url]||0)>0})]),Pt(3,l,()=>St),w(e,l)}),s(Y),s(C);var z=c(C,2);{var _t=e=>{Kt(e,{click:()=>{p(f,null)},content:l=>{var _=le(),u=K(_);u.__click=[oe,f];var k=n(u);zt(k),s(u);var y=c(u,2);Ut(y,{get recipe(){return t(f)},show_colors:!0}),w(l,_)},$$slots:{content:!0}})};$t(z,e=>{t(f)&&e(_t)})}var ct=c(z,2);Jt(ct,{}),w(o,T),xt(),X()}gt(["click"]);export{qe as component};
