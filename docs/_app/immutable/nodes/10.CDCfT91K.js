import{d as tt,t as u,a as l,c as te,s as E,b as _e}from"../chunks/CYIjoMr1.js";import{p as at,d as Ae,i as e,n as A,m as je,l as H,f as W,a as rt,s as i,c as r,r as a,o as ve,t as O,x as st}from"../chunks/DdW1EsoA.js";import{s as de}from"../chunks/CglLUYzN.js";import{i as g}from"../chunks/xsFzECmQ.js";import{e as J,i as Q}from"../chunks/DWk5ghVn.js";import{r as ae,b as ue}from"../chunks/BhOZLbEh.js";import{O as De,b as it}from"../chunks/Cg7dEFf2.js";import{s as lt,b as ot,a as nt}from"../chunks/CkSXy_xo.js";import{g as ct,s as _t,b as vt,c as dt,f as ut,L as pt,e as pe}from"../chunks/DmioJiEo.js";import{f as ft,h as mt,j as gt,a as ht}from"../chunks/BfBYdUds.js";import{C as bt}from"../chunks/YJ_dkEMD.js";import{M as fe}from"../chunks/D3fA0VwG.js";import{P as kt}from"../chunks/CRXheolD.js";import{T as xt}from"../chunks/AmogBFoe.js";import{C as re}from"../chunks/ZPX3YQaU.js";import{R as wt}from"../chunks/55SrSJZN.js";import{S as Ke}from"../chunks/BJl-EtSc.js";var yt=(v,o,d)=>{v.stopPropagation(),o(e(d).recipe_url)},Rt=u('<button class="flex-row vertically-centered"><div class="grow flex-row vertically-centered flex-start gap1"><!> <span class="left"> </span></div> <div> </div></button>'),$t=u("<div>None</div>"),Ct=u('<div class="list flex-col"><!> <!></div>'),St=(v,o)=>{e(o)&&(e(o).checked_items={})},Nt=(v,o,d)=>{e(o).checked_items[e(d).text]=v.target.checked},Ot=u('<span class="shrink blue rounded p0_5 ph0"> </span>'),Pt=(v,o,d)=>{o(e(d).recipe_url,e(d).text)},It=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow gap0_5"><!> <span class="grow"> </span> <button class="flex-row vertically-centered gap0_5 p0_5" title="Info" aria-label="Info"><!></button></div></label>'),Et=u('<div class="list"></div>'),At=(v,o,d)=>{e(o).checked_items[e(d).name]=v.target.checked},jt=(v,o,d)=>{o[e(d).name]=!o[e(d).name]},Dt=u('<button class="flex-row vertically-centered gap0_5 shrink mla" title="See sources" aria-label="See sources"><span> </span></button>'),Kt=(v,o,d)=>{o(e(d).recipe_url,e(d).original_line)},Lt=u('<button class="blue rounded p0_5 shrink flex-row vertically-centered gap0_5" title="See original line" aria-label="See original line"><!> <!></button>'),Mt=u('<div class="flex-row gap0_5 wrap flex-start"></div>'),Tt=u('<label class="selectable"><input type="checkbox"> <div class="flex-col grow"><div class="flex-row grow vertically-centered"><h2 class="grow"> </h2> <!></div> <!></div></label>'),Ut=u('<div class="list"></div>'),Bt=u('<div class="list"><div>No items yet</div></div>'),Ft=(v,o,d)=>{e(o).checked_items[e(d)]=v.target.checked},Ht=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow"><span class="grow"> </span> <button class="shrink" title="Delete" aria-label="Delete"><!></button></div></label>'),Wt=(v,o)=>{v.key==="Enter"&&(v.stopPropagation(),o())},Xt=(v,o)=>{o()},qt=u('<div class="list"><!> <div class="flex-row"><label class="flex-row grow gap1"><span>New item:</span> <input class="grow"></label> <button title="Add" aria-label="Add"><!></button></div></div>'),zt=u('<div class="flex-col gap1"><div class="card black flex-col gap1"><!> <div class="flex-row gap0_5 wrap"><!> <!></div></div> <div class="card has-list flex-col gap1"><div class="flex-row vertically-centered"><h2 class="grow">Checklist <!></h2> <button class="disableable shrink p0">Reset checklist</button></div> <div class="full-width flex-col gap1"><!> <!> <!> <!></div></div></div>'),Gt=u('<div class="card"><h1>ERROR: shopping list is missing</h1></div>'),Jt=(v,o)=>{v.stopPropagation(),A(o,null)},Qt=u('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),Vt=u("<!> <!> <!>",1);function ma(v,o){at(o,!0);const[d,Le]=lt(),Me=()=>nt(ht,"$all_recipes",d);let t=H(void 0);Ae(()=>{e(t)&&ot(gt,e(t).name)});let M=ve(()=>e(t)?dt(de(e(t)),de(Me())):{errors:[],ingredients:[]}),me=ve(()=>{var s;return Object.values(((s=e(t))==null?void 0:s.checked_items)||{}).filter(p=>!!p).length}),ge=ve(()=>{var s;return(((s=e(t))==null?void 0:s.custom_items)||[]).length+e(M).errors.length+e(M).ingredients.length});Ae(()=>{e(t)&&e(t).id!=null&&e(t).id>=0&&vt(de(e(t)))});let he=H(!1);Te();function Te(){e(he)||(A(he,!0),(async()=>{let s=ft("id");if(s!==null&&mt(s)){let p=Number(s);A(t,await ct(p,{include_recipes:!0}),!0),e(t)&&_t(e(t).id)}})())}async function se(s,p){let j=await ut(s);j&&(A(Y,j,!0),A(ke,p,!0))}let ie=H(!1),V=H(!1),be=je({}),Y=H(null),ke=H(void 0),le=H(je([])),X=H(null);function xe(){e(X)&&e(t)&&(e(t).custom_items||(e(t).custom_items=[]),e(t).custom_items.push(e(X)),A(X,""))}function Ue(s){if(e(t)){e(t).custom_items||(e(t).custom_items=[]);let p=e(t).custom_items.splice(s,1);p[0]&&delete e(t).checked_items[p[0]]}}function Yt(s){return s}var we=Vt(),ye=W(we);{var Be=s=>{var p=zt(),j=r(p),T=r(j);re(T,{title:"Source recipes",start_collapsed:!0,content:D=>{var P=Ct(),x=r(P);{var U=f=>{var w=te(),m=W(w);J(m,17,()=>e(t).items,Q,(_,h)=>{var y=Rt();y.__click=[yt,se,h];var C=r(y),K=r(C);fe(K);var S=i(K,2),N=r(S,!0);a(S),a(C);var R=i(C,2),B=r(R,!0);a(R),a(y),O(()=>{var b;E(N,((b=e(h).recipe)==null?void 0:b.title)||"<UNKNOWN>"),E(B,e(h).quantity)}),l(_,y)}),l(f,w)};g(x,f=>{e(t)&&f(U)})}var n=i(x,2);{var I=f=>{var w=$t();l(f,w)};g(n,f=>{var w;(w=e(t))!=null&&w.items.length||f(I)})}a(P),l(D,P)}});var L=i(T,2),q=r(L);Ke(q,{text:"Show calculations",get checked(){return e(ie)},onchange:c=>{A(ie,c,!0)}});var Z=i(q,2);Ke(Z,{text:"Hide checked",get checked(){return e(V)},onchange:c=>{A(V,c,!0)}}),a(L),a(j);var ee=i(j,2),oe=r(ee),ne=r(oe),qe=i(r(ne));{var ze=c=>{var D=_e();O(()=>E(D,`(${e(me)??""} / ${e(ge)??""})`)),l(c,D)};g(qe,c=>{e(ge)&&c(ze)})}a(ne);var $e=i(ne,2);$e.__click=[St,t],a(oe);var Ce=i(oe,2),Se=r(Ce);{var Ge=c=>{re(c,{title:"Unknown Ingredients",content:P=>{var x=Et();J(x,21,()=>e(M).errors,Q,(U,n)=>{var I=te(),f=W(I);{var w=m=>{var _=It(),h=r(_);ae(h),h.__change=[Nt,t,n];var y=i(h,2),C=r(y);{var K=b=>{var $=Ot(),k=r($);a($),O(F=>E(k,`x${F??""}`),[()=>e(n).recipe_count]),l(b,$)};g(C,b=>{e(n).recipe_count!==1&&b(K)})}var S=i(C,2),N=r(S,!0);a(S);var R=i(S,2);R.__click=[Pt,se,n];var B=r(R);fe(B),a(R),a(y),a(_),O(b=>{ue(h,e(t).checked_items[e(n).text]),E(N,b)},[()=>e(n).text.replaceAll("**","").replaceAll(/\([^\)]+\)/g,"").replace(pt,"").replace(/, .*/,"").trim()]),l(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).text]))&&m(w)})}l(U,I)}),a(x),l(P,x)}})};g(Se,c=>{e(M).errors.length&&c(Ge)})}var Ne=i(Se,2);{var Je=c=>{re(c,{title:"Known Ingredients",content:P=>{var x=Ut();J(x,21,()=>e(M).ingredients,Q,(U,n)=>{var I=te(),f=W(I);{var w=m=>{var _=Tt(),h=r(_);ae(h),h.__change=[At,t,n];var y=i(h,2),C=r(y),K=r(C),S=r(K,!0);a(K);var N=i(K,2);{var R=$=>{var k=Dt();k.__click=[jt,be,n];var F=r(k),z=r(F,!0);a(F),a(k),O(G=>E(z,G),[()=>pe(e(n))]),l($,k)};g(N,$=>{pe(e(n))!=="ERROR"&&$(R)})}a(C);var B=i(C,2);{var b=$=>{var k=Mt();J(k,21,()=>e(n).quantities,Q,(F,z)=>{var G=Lt();G.__click=[Kt,se,z];var Pe=r(G);fe(Pe);var Ie=i(Pe),Ye=i(Ie);{var Ze=ce=>{var Ee=_e();O(et=>E(Ee,`x${et??""}`),[()=>e(z).recipe_count]),l(ce,Ee)};g(Ye,ce=>{e(z).recipe_count!==1&&ce(Ze)})}a(G),O(()=>E(Ie,` ${e(z).ingredient_quantity??""} `)),l(F,G)}),a(k),l($,k)};g(B,$=>{(e(ie)||be[e(n).name]||pe(e(n))==="ERROR")&&$(b)})}a(y),a(_),O(()=>{ue(h,e(t).checked_items[e(n).name]),E(S,e(n).name)}),l(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).name]))&&m(w)})}l(U,I)}),a(x),l(P,x)}})};g(Ne,c=>{e(M).ingredients.length&&c(Je)})}var Oe=i(Ne,2);{var Qe=c=>{var D=Bt();l(c,D)};g(Oe,c=>{!e(M).ingredients.length&&!e(M).errors.length&&c(Qe)})}var Ve=i(Oe,2);re(Ve,{title:"Custom items",content:D=>{var P=qt(),x=r(P);J(x,17,()=>{var m;return((m=e(t))==null?void 0:m.custom_items)||[]},Q,(m,_,h)=>{var y=te(),C=W(y);{var K=S=>{var N=Ht(),R=r(N);ae(R),R.__change=[Ft,t,_];var B=i(R,2),b=r(B),$=r(b,!0);a(b);var k=i(b,2);k.__click=()=>{Ue(h)};var F=r(k);xt(F),a(k),a(B),a(N),O(()=>{ue(R,e(t).checked_items[e(_)]),E($,e(_))}),l(S,N)};g(C,S=>{var N;(!e(V)||!((N=e(t))!=null&&N.checked_items[e(_)]))&&S(K)})}l(m,y)});var U=i(x,2),n=r(U),I=i(r(n),2);ae(I),I.__keydown=[Wt,xe],a(n);var f=i(n,2);f.__click=[Xt,xe];var w=r(f);kt(w),a(f),a(U),a(P),O(()=>f.disabled=!e(X)),it(I,()=>e(X),m=>A(X,m)),l(D,P)}}),a(Ce),a(ee),a(p),O(()=>$e.disabled=!e(me)),l(s,p)},Fe=s=>{var p=Gt();l(s,p)};g(ye,s=>{e(t)?s(Be):s(Fe,!1)})}var Re=i(ye,2);{var He=s=>{De(s,{click:()=>{A(Y,null)},content:j=>{var T=Qt(),L=W(T);L.__click=[Jt,Y];var q=r(L);bt(q),a(L);var Z=i(L,2);wt(Z,{get recipe(){return e(Y)},get line_to_focus(){return e(ke)},show_colors:!0}),l(j,T)},$$slots:{content:!0}})};g(Re,s=>{e(Y)&&s(He)})}var We=i(Re,2);{var Xe=s=>{De(s,{click:()=>{A(le,[],!0)},content:j=>{var T=te(),L=W(T);J(L,17,()=>e(le),Q,(q,Z)=>{st();var ee=_e();O(()=>E(ee,e(Z))),l(q,ee)}),l(j,T)},$$slots:{content:!0}})};g(We,s=>{e(le).length&&s(Xe)})}l(v,we),rt(),Le()}tt(["click","change","keydown"]);export{ma as component};
