import{d as tt,t as u,a as o,c as te,s as E,b as _e}from"../chunks/aHhSpOdM.js";import{p as at,D as Ae,o as e,q as A,m as De,l as B,f as F,a as rt,s as l,c as r,r as a,u as ve,t as O,z as st}from"../chunks/BYTqjnmQ.js";import{s as de}from"../chunks/Ci9CMcXt.js";import{i as g}from"../chunks/DZ2x0wit.js";import{e as J,i as Q}from"../chunks/CLXJqfNh.js";import{r as ae,b as ue}from"../chunks/DbSBZFay.js";import{O as je,b as lt}from"../chunks/Yh1PSW4n.js";import{s as ot,b as it,a as nt}from"../chunks/BwSmt7X6.js";import{g as ct,s as _t,b as vt,c as dt,f as ut,L as pt,e as pe}from"../chunks/CylpzTi1.js";import{f as ft,h as mt,j as gt,a as ht}from"../chunks/64BZPr2v.js";import{C as bt}from"../chunks/Cyt5gH4l.js";import{M as fe}from"../chunks/C63kc6XK.js";import{P as kt}from"../chunks/Dkegijom.js";import{T as xt}from"../chunks/CpgGpn1j.js";import{C as re}from"../chunks/Phvjr3Cx.js";import{R as wt}from"../chunks/CJPo3_SQ.js";import{S as Ke}from"../chunks/D3_WDWYc.js";var yt=(v,i,d)=>{v.stopPropagation(),i(e(d).recipe_url)},$t=u('<button class="flex-row vertically-centered"><div class="grow flex-row vertically-centered flex-start gap1"><!> <span class="left"> </span></div> <div> </div></button>'),Rt=u("<div>None</div>"),Ct=u('<div class="list flex-col"><!> <!></div>'),St=(v,i)=>{e(i)&&(e(i).checked_items={})},Nt=(v,i,d)=>{e(i).checked_items[e(d).text]=v.target.checked},Ot=u('<span class="shrink blue rounded p0_5 ph0"> </span>'),Pt=(v,i,d)=>{i(e(d).recipe_url,e(d).text)},It=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow gap0_5"><!> <span class="grow"> </span> <button class="flex-row vertically-centered gap0_5 p0_5" title="Info" aria-label="Info"><!></button></div></label>'),Et=u('<div class="list"></div>'),At=(v,i,d)=>{e(i).checked_items[e(d).name]=v.target.checked},Dt=(v,i,d)=>{i[e(d).name]=!i[e(d).name]},jt=u('<button class="flex-row vertically-centered gap0_5 shrink mla" title="See sources" aria-label="See sources"><span> </span></button>'),Kt=(v,i,d)=>{i(e(d).recipe_url,e(d).original_line)},Lt=u('<button class="blue rounded p0_5 shrink flex-row vertically-centered gap0_5" title="See original line" aria-label="See original line"><!> <!></button>'),Mt=u('<div class="flex-row gap0_5 wrap flex-start"></div>'),Tt=u('<label class="selectable"><input type="checkbox"> <div class="flex-col grow"><div class="flex-row grow vertically-centered"><h2 class="grow"> </h2> <!></div> <!></div></label>'),Ut=u('<div class="list"></div>'),qt=u('<div class="list"><div>No items yet</div></div>'),zt=(v,i,d)=>{e(i).checked_items[e(d)]=v.target.checked},Bt=u('<label class="selectable"><input type="checkbox"> <div class="flex-row vertically-centered grow"><span class="grow"> </span> <button class="shrink" title="Delete" aria-label="Delete"><!></button></div></label>'),Ft=(v,i)=>{v.key==="Enter"&&(v.stopPropagation(),i())},Ht=(v,i)=>{i()},Wt=u('<div class="list"><!> <div class="flex-row"><label class="flex-row grow gap1"><span>New item:</span> <input class="grow"></label> <button title="Add" aria-label="Add"><!></button></div></div>'),Xt=u('<div class="flex-col gap1"><div class="card black flex-col gap1"><!> <div class="flex-row gap0_5 wrap"><!> <!></div></div> <div class="card has-list flex-col gap1"><div class="flex-row vertically-centered"><h2 class="grow">Checklist <!></h2> <button class="disableable shrink p0">Reset checklist</button></div> <div class="full-width flex-col gap1"><!> <!> <!> <!></div></div></div>'),Gt=u('<div class="card"><h1>ERROR: shopping list is missing</h1></div>'),Jt=(v,i)=>{v.stopPropagation(),A(i,null)},Qt=u('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),Vt=u("<!> <!> <!>",1);function ma(v,i){at(i,!0);const[d,Le]=ot(),Me=()=>nt(ht,"$all_recipes",d);let t=B(void 0);Ae(()=>{e(t)&&it(gt,e(t).name)});let M=ve(()=>e(t)?dt(de(e(t)),de(Me())):{errors:[],ingredients:[]}),me=ve(()=>{var s;return Object.values(((s=e(t))==null?void 0:s.checked_items)||{}).filter(p=>!!p).length}),ge=ve(()=>{var s;return(((s=e(t))==null?void 0:s.custom_items)||[]).length+e(M).errors.length+e(M).ingredients.length});Ae(()=>{e(t)&&e(t).id!=null&&e(t).id>=0&&vt(de(e(t)))});let he=B(!1);Te();function Te(){e(he)||(A(he,!0),(async()=>{let s=ft("id");if(s!==null&&mt(s)){let p=Number(s);A(t,await ct(p,{include_recipes:!0}),!0),e(t)&&_t(e(t).id)}})())}async function se(s,p){let D=await ut(s);D&&(A(Y,D,!0),A(ke,p,!0))}let le=B(!1),V=B(!1),be=De({}),Y=B(null),ke=B(void 0),oe=B(De([])),H=B(null);function xe(){e(H)&&e(t)&&(e(t).custom_items||(e(t).custom_items=[]),e(t).custom_items.push(e(H)),A(H,""))}function Ue(s){if(e(t)){e(t).custom_items||(e(t).custom_items=[]);let p=e(t).custom_items.splice(s,1);p[0]&&delete e(t).checked_items[p[0]]}}function Yt(s){return s}var we=Vt(),ye=F(we);{var qe=s=>{var p=Xt(),D=r(p),T=r(D);re(T,{title:"Source recipes",collapsed:!0,content:j=>{var P=Ct(),x=r(P);{var U=f=>{var w=te(),m=F(w);J(m,17,()=>e(t).items,Q,(_,h)=>{var y=$t();y.__click=[yt,se,h];var C=r(y),K=r(C);fe(K);var S=l(K,2),N=r(S,!0);a(S),a(C);var $=l(C,2),q=r($,!0);a($),a(y),O(()=>{var b;E(N,((b=e(h).recipe)==null?void 0:b.title)||"<UNKNOWN>"),E(q,e(h).quantity)}),o(_,y)}),o(f,w)};g(x,f=>{e(t)&&f(U)})}var n=l(x,2);{var I=f=>{var w=Rt();o(f,w)};g(n,f=>{var w;(w=e(t))!=null&&w.items.length||f(I)})}a(P),o(j,P)},$$slots:{content:!0}});var L=l(T,2),W=r(L);Ke(W,{text:"Show calculations",get checked(){return e(le)},onchange:c=>{A(le,c,!0)}});var Z=l(W,2);Ke(Z,{text:"Hide checked",get checked(){return e(V)},onchange:c=>{A(V,c,!0)}}),a(L),a(D);var ee=l(D,2),ie=r(ee),ne=r(ie),We=l(r(ne));{var Xe=c=>{var j=_e();O(()=>E(j,`(${e(me)??""} / ${e(ge)??""})`)),o(c,j)};g(We,c=>{e(ge)&&c(Xe)})}a(ne);var Re=l(ne,2);Re.__click=[St,t],a(ie);var Ce=l(ie,2),Se=r(Ce);{var Ge=c=>{re(c,{title:"Unknown Ingredients",content:P=>{var x=Et();J(x,21,()=>e(M).errors,Q,(U,n)=>{var I=te(),f=F(I);{var w=m=>{var _=It(),h=r(_);ae(h),h.__change=[Nt,t,n];var y=l(h,2),C=r(y);{var K=b=>{var R=Ot(),k=r(R);a(R),O(z=>E(k,`x${z??""}`),[()=>e(n).recipe_count]),o(b,R)};g(C,b=>{e(n).recipe_count!==1&&b(K)})}var S=l(C,2),N=r(S,!0);a(S);var $=l(S,2);$.__click=[Pt,se,n];var q=r($);fe(q),a($),a(y),a(_),O(b=>{ue(h,e(t).checked_items[e(n).text]),E(N,b)},[()=>e(n).text.replaceAll("**","").replaceAll(/\([^\)]+\)/g,"").replace(pt,"").replace(/, .*/,"").trim()]),o(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).text]))&&m(w)})}o(U,I)}),a(x),o(P,x)},$$slots:{content:!0}})};g(Se,c=>{e(M).errors.length&&c(Ge)})}var Ne=l(Se,2);{var Je=c=>{re(c,{title:"Known Ingredients",content:P=>{var x=Ut();J(x,21,()=>e(M).ingredients,Q,(U,n)=>{var I=te(),f=F(I);{var w=m=>{var _=Tt(),h=r(_);ae(h),h.__change=[At,t,n];var y=l(h,2),C=r(y),K=r(C),S=r(K,!0);a(K);var N=l(K,2);{var $=R=>{var k=jt();k.__click=[Dt,be,n];var z=r(k),X=r(z,!0);a(z),a(k),O(G=>E(X,G),[()=>pe(e(n))]),o(R,k)};g(N,R=>{pe(e(n))!=="ERROR"&&R($)})}a(C);var q=l(C,2);{var b=R=>{var k=Mt();J(k,21,()=>e(n).quantities,Q,(z,X)=>{var G=Lt();G.__click=[Kt,se,X];var Pe=r(G);fe(Pe);var Ie=l(Pe),Ye=l(Ie);{var Ze=ce=>{var Ee=_e();O(et=>E(Ee,`x${et??""}`),[()=>e(X).recipe_count]),o(ce,Ee)};g(Ye,ce=>{e(X).recipe_count!==1&&ce(Ze)})}a(G),O(()=>E(Ie,` ${e(X).ingredient_quantity??""} `)),o(z,G)}),a(k),o(R,k)};g(q,R=>{(e(le)||be[e(n).name]||pe(e(n))==="ERROR")&&R(b)})}a(y),a(_),O(()=>{ue(h,e(t).checked_items[e(n).name]),E(S,e(n).name)}),o(m,_)};g(f,m=>{var _;(!e(V)||!((_=e(t))!=null&&_.checked_items[e(n).name]))&&m(w)})}o(U,I)}),a(x),o(P,x)},$$slots:{content:!0}})};g(Ne,c=>{e(M).ingredients.length&&c(Je)})}var Oe=l(Ne,2);{var Qe=c=>{var j=qt();o(c,j)};g(Oe,c=>{!e(M).ingredients.length&&!e(M).errors.length&&c(Qe)})}var Ve=l(Oe,2);re(Ve,{title:"Custom items",content:j=>{var P=Wt(),x=r(P);J(x,17,()=>{var m;return((m=e(t))==null?void 0:m.custom_items)||[]},Q,(m,_,h)=>{var y=te(),C=F(y);{var K=S=>{var N=Bt(),$=r(N);ae($),$.__change=[zt,t,_];var q=l($,2),b=r(q),R=r(b,!0);a(b);var k=l(b,2);k.__click=()=>{Ue(h)};var z=r(k);xt(z),a(k),a(q),a(N),O(()=>{ue($,e(t).checked_items[e(_)]),E(R,e(_))}),o(S,N)};g(C,S=>{var N;(!e(V)||!((N=e(t))!=null&&N.checked_items[e(_)]))&&S(K)})}o(m,y)});var U=l(x,2),n=r(U),I=l(r(n),2);ae(I),I.__keydown=[Ft,xe],a(n);var f=l(n,2);f.__click=[Ht,xe];var w=r(f);kt(w),a(f),a(U),a(P),O(()=>f.disabled=!e(H)),lt(I,()=>e(H),m=>A(H,m)),o(j,P)},$$slots:{content:!0}}),a(Ce),a(ee),a(p),O(()=>Re.disabled=!e(me)),o(s,p)},ze=s=>{var p=Gt();o(s,p)};g(ye,s=>{e(t)?s(qe):s(ze,!1)})}var $e=l(ye,2);{var Be=s=>{je(s,{click:()=>{A(Y,null)},content:D=>{var T=Qt(),L=F(T);L.__click=[Jt,Y];var W=r(L);bt(W),a(L);var Z=l(L,2);wt(Z,{get recipe(){return e(Y)},get line_to_focus(){return e(ke)},show_colors:!0}),o(D,T)},$$slots:{content:!0}})};g($e,s=>{e(Y)&&s(Be)})}var Fe=l($e,2);{var He=s=>{je(s,{click:()=>{A(oe,[],!0)},content:D=>{var T=te(),L=F(T);J(L,17,()=>e(oe),Q,(W,Z)=>{st();var ee=_e();O(()=>E(ee,e(Z))),o(W,ee)}),o(D,T)},$$slots:{content:!0}})};g(Fe,s=>{e(oe).length&&s(He)})}o(v,we),rt(),Le()}tt(["click","change","keydown"]);export{ma as component};
