import{l as ne,d as re,t as ae,a as ie,s as oe}from"../chunks/SB0OVNle.js";import{D as J,az as se,p as le,d as D,z as H,A as ue,aA as _e,C as d,c as v,t as pe,i as n,a as fe,s as c,B as W,r as m}from"../chunks/DSkh8qEa.js";import{s as A}from"../chunks/CcQv_5Hk.js";import{s as ce,b as de,a as ve}from"../chunks/CHrfQ6KJ.js";import{a as me}from"../chunks/B6ZjVAHu.js";import{O as f,b as he,g as ge,s as be,k as E,l as N,c as xe,C as T,e as $e,L as G}from"../chunks/CdM8yK0z.js";import{w as we,n as ke,j as ye,f as je,h as Ce,a as Me}from"../chunks/BXxlaY2r.js";import{S as Oe}from"../chunks/7KZUXLyZ.js";function Q(t,s,l){if(t.multiple)return Se(t,s);for(var _ of t.options){var u=h(_);if(se(u,s)){_.selected=!0;return}}(!l||s!==void 0)&&(t.selectedIndex=-1)}function Re(t,s){J(()=>{var l=new MutationObserver(()=>{var _=t.__value;Q(t,_)});return l.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{l.disconnect()}})}function Pe(t,s,l=s){var _=!0;ne(t,"change",u=>{var i=u?"[selected]":":checked",p;if(t.multiple)p=[].map.call(t.querySelectorAll(i),h);else{var g=t.querySelector(i)??t.querySelector("option:not([disabled])");p=g&&h(g)}l(p)}),J(()=>{var u=s();if(Q(t,u,_),_&&u===void 0){var i=t.querySelector(":checked");i!==null&&(u=h(i),l(u))}t.__value=u,_=!1}),Re(t)}function Se(t,s){for(var l of t.options)l.selected=~s.indexOf(h(l))}function h(t){return"__value"in t?t.__value:t.value}var qe=async(t,s)=>{await we(n(s)),ke("Text copied to clipboard")},Ae=ae('<div class="card black flex-col gap1"><h2>Export</h2> <label>Output type: <select><option>Markdown checkboxes</option><option>Markdown list</option><option>Plain text</option></select></label> <div class="flex-row gap0_5 flex-wrap flex-start"><button class="blue rounded">Copy to clipboard</button> <!></div> <h3>Preview</h3> <pre class="svelte-13ppi9h"> </pre></div>');function Ue(t,s){le(s,!0);const[l,_]=ce(),u=()=>ve(Me,"$all_recipes",l);let i=H(void 0);D(()=>{n(i)&&de(ye,n(i).name)});let p=d(()=>n(i)?xe(A(n(i)),A(u())):{errors:[],ingredients:[]}),g=d(()=>{var e;return[$("Unknown items",n(p).errors).join(`
`),$("Known items",n(p).ingredients).join(`
`),$("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),V=d(()=>{var e;return[w("Unknown items",n(p).errors).join(`
`),w("Known items",n(p).ingredients).join(`
`),w("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),Y=d(()=>{var e;return[k("Unknown items",n(p).errors).join(`
`),k("Known items",n(p).ingredients).join(`
`),k("Custom items",(e=n(i))==null?void 0:e.custom_items).join(`
`)].join(`
`).trim()}),x=H(ue(f.Markdown)),b=d(()=>Z(n(x)));function Z(e){switch(e){case f.Markdown:return n(g);case f.PlainText:return n(V);case f.Naked:return n(Y);default:return"ERROR"}}let I=!1;_e(()=>{K()}),me(()=>{K()}),D(()=>{n(i)&&n(i).id!=null&&he(A(n(i)))});function K(){I||(I=!0,(async()=>{let e=je("id");if(e!==null&&Ce(e)){let a=Number(e);W(i,await ge(a,{include_recipes:!0}),!0),n(i)&&be(n(i).id)}})())}function $(e,a){if(!a)return[];let o=[`# ${e}
`];for(let r of a)E(r)?o.push(`${T} ${y(r)}`):N(r)?o.push(`${T} ${j(r)}`):o.push(`${T} ${r}`);return o}function w(e,a){if(!(a!=null&&a.length))return[];let o=[`# ${e}
`];for(let r of a)E(r)?o.push(`- ${y(r)}`):N(r)?o.push(`- ${j(r)}`):o.push(`- ${r}`);return o}function k(e,a){if(!(a!=null&&a.length))return[];let o=[];for(let r of a)E(r)?o.push(y(r)):N(r)?o.push(j(r)):o.push(`${r}`);return o}function y(e){let a=B(e.name),o=$e(e);return o!=="ERROR"?`${o} ${a}`:[a,...e.quantities.map(r=>r.recipe_count!==1?`(${r.ingredient_quantity} x${r.recipe_count})`:`(${r.ingredient_quantity})`)].join(" ")}function j(e){let a=B(e.text);return e.recipe_count!==1?`${a} x${e.recipe_count}`:a}function B(e){return e.startsWith(G)&&(e=e.substr(G.length)),e=e.replaceAll(`
`," ").replaceAll("  "," ").replaceAll("**",""),e}var C=Ae(),M=c(v(C),2),O=c(v(M)),R=v(O),F={},P=c(R),L={},U=c(P),X={};m(O),m(M);var S=c(M,2),q=v(S);q.__click=[qe,b];var ee=c(q,2);Oe(ee,{with_text:!0,extra_classes:"blue rounded",onshare:async()=>{await navigator.share({title:"Shopping list",text:n(b)})}}),m(S);var z=c(S,4),te=v(z);m(z),m(C),pe(()=>{F!==(F=f.Markdown)&&(R.value=(R.__value=f.Markdown)??""),L!==(L=f.PlainText)&&(P.value=(P.__value=f.PlainText)??""),X!==(X=f.Naked)&&(U.value=(U.__value=f.Naked)??""),q.disabled=!n(b).length,oe(te,`        ${n(b)??""}
    `)}),Pe(O,()=>n(x),e=>W(x,e)),ie(t,C),fe(),_()}re(["click"]);export{Ue as component};
