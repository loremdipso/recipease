import{l as ne,d as re,t as ae,a as ie,s as oe}from"../chunks/CfNwE0Bq.js";import{D as J,ax as se,p as le,d as X,z as D,A as z,as as ue,C as v,c as d,t as _e,i as n,a as pe,s as c,B as H,r as m}from"../chunks/awlFoezV.js";import{s as W}from"../chunks/BBaQ3y4Z.js";import{s as fe,b as ce}from"../chunks/BCsxFzkL.js";import{a as ve}from"../chunks/CAe7mk4b.js";import{g as de,O as p,n as me,j as he,k as ge,m as xe,o as be,s as ke,p as $e,B as E,C as T,q as we,D as A,t as ye,L as G}from"../chunks/QCCBpY_l.js";import{S as je}from"../chunks/D0jdan1G.js";function Q(t,s,l){if(t.multiple)return Oe(t,s);for(var u of t.options){var r=h(u);if(se(r,s)){u.selected=!0;return}}(!l||s!==void 0)&&(t.selectedIndex=-1)}function Ce(t,s){J(()=>{var l=new MutationObserver(()=>{var u=t.__value;Q(t,u)});return l.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{l.disconnect()}})}function Me(t,s,l=s){var u=!0;ne(t,"change",r=>{var f=r?"[selected]":":checked",_;if(t.multiple)_=[].map.call(t.querySelectorAll(f),h);else{var g=t.querySelector(f)??t.querySelector("option:not([disabled])");_=g&&h(g)}l(_)}),J(()=>{var r=s();if(Q(t,r,u),u&&r===void 0){var f=t.querySelector(":checked");f!==null&&(r=h(f),l(r))}t.__value=r,u=!1}),Ce(t)}function Oe(t,s){for(var l of t.options)l.selected=~s.indexOf(h(l))}function h(t){return"__value"in t?t.__value:t.value}var Re=async(t,s)=>{await navigator.clipboard.writeText(n(s)),me("Text copied to clipboard")},qe=ae('<div class="card black flex-col gap1"><h2>Export</h2> <label>Output type: <select><option>Markdown checkboxes</option><option>Markdown list</option><option>Plain text</option></select></label> <div class="flex-row gap0_5 flex-wrap flex-start"><button class="blue rounded">Copy to clipboard</button> <!></div> <h3>Preview</h3> <pre class="svelte-13ppi9h"> </pre></div>');function Ie(t,s){le(s,!0);const[l,u]=fe();let r=z(null);X(()=>{n(r)&&ce(he,n(r).name)});let f=D(de().reverse()),_=v(()=>n(r)?we(W(n(r)),W(f)):{errors:[],ingredients:[]}),g=v(()=>{var e;return[k("Unknown items",n(_).errors).join(`
`),k("Known items",n(_).ingredients).join(`
`),k("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),V=v(()=>{var e;return[$("Unknown items",n(_).errors).join(`
`),$("Known items",n(_).ingredients).join(`
`),$("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`

`).trim()}),Y=v(()=>{var e;return[w("Unknown items",n(_).errors).join(`
`),w("Known items",n(_).ingredients).join(`
`),w("Custom items",(e=n(r))==null?void 0:e.custom_items).join(`
`)].join(`
`).trim()}),b=z(D(p.Markdown)),x=v(()=>Z(n(b)));function Z(e){switch(e){case p.Markdown:return n(g);case p.PlainText:return n(V);case p.Naked:return n(Y);default:return"ERROR"}}ue(()=>{N()}),ve(()=>{N()}),X(()=>{n(r)&&n(r).id>=0&&ge(n(r))});function N(){if(n(r))return;let e=xe("id");if(e!==null&&be(e)){let i=Number(e);ke(i),H(r,$e(i),!0)}}function k(e,i){if(!i)return[];let o=[`# ${e}
`];for(let a of i)E(a)?o.push(`${A} ${y(a)}`):T(a)?o.push(`${A} ${j(a)}`):o.push(`${A} ${a}`);return o}function $(e,i){if(!(i!=null&&i.length))return[];let o=[`# ${e}
`];for(let a of i)E(a)?o.push(`- ${y(a)}`):T(a)?o.push(`- ${j(a)}`):o.push(`- ${a}`);return o}function w(e,i){if(!(i!=null&&i.length))return[];let o=[];for(let a of i)E(a)?o.push(y(a)):T(a)?o.push(j(a)):o.push(`${a}`);return o}function y(e){let i=B(e.name),o=ye(e);return o!=="ERROR"?`${o} ${i}`:[i,...e.quantities.map(a=>a.recipe_count!==1?`(${a.ingredient_quantity} x${a.recipe_count})`:`(${a.ingredient_quantity})`)].join(" ")}function j(e){let i=B(e.text);return e.recipe_count!==1?`${i} x${e.recipe_count}`:i}function B(e){return e.startsWith(G)&&(e=e.substr(G.length)),e=e.replaceAll(`
`," ").replaceAll("  "," ").replaceAll("**",""),e}var C=qe(),M=c(d(C),2),O=c(d(M)),R=d(O),I={},q=c(R),K={},F=c(q),L={};m(O),m(M);var P=c(M,2),S=d(P);S.__click=[Re,x];var ee=c(S,2);je(ee,{with_text:!0,extra_classes:"blue rounded",onshare:async()=>{await navigator.share({title:"Shopping list",text:n(x)})}}),m(P);var U=c(P,4),te=d(U);m(U),m(C),_e(()=>{I!==(I=p.Markdown)&&(R.value=(R.__value=p.Markdown)??""),K!==(K=p.PlainText)&&(q.value=(q.__value=p.PlainText)??""),L!==(L=p.Naked)&&(F.value=(F.__value=p.Naked)??""),S.disabled=!n(x).length,oe(te,`        ${n(x)??""}
    `)}),Me(O,()=>n(b),e=>H(b,e)),ie(t,C),pe(),u()}re(["click"]);export{Ie as component};
