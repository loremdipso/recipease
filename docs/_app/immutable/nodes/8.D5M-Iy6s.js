import{n as mt,a as w,d as bt,t as O,s as H}from"../chunks/SB0OVNle.js";import{p as gt,z as b,A as I,i as t,B as p,d as ht,f as J,c as n,C as kt,s as u,a as yt,G as j,r as s,t as xt}from"../chunks/DSkh8qEa.js";import{s as K}from"../chunks/CcQv_5Hk.js";import{i as wt}from"../chunks/CvGVVl0L.js";import{e as $t}from"../chunks/C4ChMz49.js";import{s as Ct}from"../chunks/XkMwF1L_.js";import{t as Pt,s as Rt}from"../chunks/Du2Mpddd.js";import{b as St,s as Mt,a as Q}from"../chunks/CHrfQ6KJ.js";import{j as qt,s as U,g as At,a as jt,b as Dt}from"../chunks/yoqPm747.js";import{j as D,f as Ot,s as Bt,k as Ft,h as Lt,c as Nt,a as Tt}from"../chunks/mITXVc5a.js";import{C as zt}from"../chunks/OaZbCfUW.js";import{M as Gt}from"../chunks/CZcAYEqQ.js";import"../chunks/lJugi39j.js";import{P as Yt}from"../chunks/DZmU10Ic.js";import{R as V}from"../chunks/DEaax3ov.js";import{S as Et}from"../chunks/BR2bAqsn.js";import{T as Ht}from"../chunks/BaRewT1R.js";import{O as It}from"../chunks/gtfbXTp4.js";import{R as Jt}from"../chunks/DnqlUQfQ.js";import{R as Kt}from"../chunks/CViftwNB.js";var Qt=mt('<svg viewBox="0 -12 32 32" width="16px" height="16px" style="min-width: 16px" fill="#ffffff"><g transform="translate(-414.000000, -1049.000000)" fill="#ffffff"><path d="M442,1049 L418,1049 C415.791,1049 414,1050.79 414,1053 C414,1055.21 415.791,1057 418,1057 L442,1057 C444.209,1057 446,1055.21 446,1053 C446,1050.79 444.209,1049 442,1049"></path></g></svg>');function Ut(o){var r=Qt();w(o,r)}function Vt(o,r){p(r,{},!0)}var Wt=(o,r)=>{jt(t(r).id),Nt("/shopping-lists")},Xt=(o,r,c)=>{o.stopPropagation(),p(r,t(c),!0)},Zt=(o,r,c)=>{o.stopPropagation(),r(t(c))},te=(o,r,c)=>{o.stopPropagation(),r(t(c))},ee=(o,r,c)=>{o.stopPropagation(),r(t(c),.5)},ae=(o,r,c)=>{o.stopPropagation(),r(t(c),0)},re=O('<div><button class="grow vertically-centered gap1 white-text" title="See preview" aria-label="See preview"><!> <h2> </h2></button> <div class="shrink flex-col centered"><div class="shrink vertically-centered"><button title="Add to list" aria-label="Add to list"><!></button> <b title="Count" aria-label="Count"> </b> <button title="Add to list" aria-label="Add to list"><!></button></div> <div class="shrink vertically-centered justify-center"><button title="Make a half batch" aria-label="Make a half batch">Â½</button> <button title="Reset" aria-label="Reset"><!></button></div></div></div>'),ie=(o,r)=>{o.stopPropagation(),p(r,null)},se=O('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),oe=O('<div class="card has-list gap1 flex-col pt0"><div class="flex-row wrap gap1 p0 pt0_5 flex-end"><button class="blue rounded icon-button ph0"><!> Reset</button> <button class="red rounded icon-button p0_5"><!> Delete list</button> <h3 class="vertically-centered rounded ph0 icon-button"><!> Autosaved</h3></div> <div class="rounded-bottom black p0_5 pt2"><!></div> <div class="list"></div></div> <!>',1);function Re(o,r){gt(r,!0);const[c,W]=Mt(),B=()=>Q(D,"$current_list_name",c),X=()=>Q(Tt,"$all_recipes",c);D.set(Z());function Z(){const e=new Date,a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0");return`${l}-${_}-${a} list`}let $=b(I([])),i=b(I({})),f=b(null),v=b(void 0),m=kt(()=>({id:t(v),name:B()||"",items:et(),checked_items:{}})),F=b(!1);tt();async function tt(){if(t(F))return;p(F,!0);let e=Ot("id");if(Number(e)===-1)p(v,await qt(K(t(m))),!0),U(t(v)),t(v)!=null?Bt("id",t(v).toString()):Ft("id");else if(Lt(e)){let a=Number(e),l=await At(a);if(l){U(t(v)),p(i,{},!0),St(D,l.name);for(let _ of l.items)t(i)[_.recipe_url]?t(i)[_.recipe_url]+=_.quantity:t(i)[_.recipe_url]=_.quantity;p(v,l.id,!0)}}}ht(()=>{B()&&t(m).id!=null&&t(m).id>=0&&Dt(K(t(m)))});function et(){let e=[];for(let a of Object.keys(t(i)))for(let l of X())if(l.url===a){e.push({recipe_url:l.url,quantity:t(i)[a]});break}return e}function at(e,a){a<=0?delete t(i)[e.url]:t(i)[e.url]=a}function L(e,a=1){t(i)[e.url]?t(i)[e.url]+=a:t(i)[e.url]=a}function rt(e){t(i)[e.url]&&(t(i)[e.url]-=1,t(i)[e.url]<=0&&delete t(i)[e.url])}var N=oe(),C=J(N),P=n(C),g=n(P);g.__click=[Vt,i];var it=n(g);V(it),j(),s(g);var h=u(g,2);h.__click=[Wt,m];var st=n(h);Ht(st),j(),s(h);var T=u(h,2),ot=n(T);Et(ot),j(),s(T),s(P);var R=u(P,2),lt=n(R);Jt(lt,{get recipes(){return t($)},set recipes(e){p($,e,!0)}}),s(R);var z=u(R,2);$t(z,21,()=>t($),e=>e.url,(e,a)=>{var l=re();let _;var d=n(l);d.__click=[Xt,f,a];var k=n(d);Gt(k);var y=u(k,2),ct=n(y,!0);s(y),s(d);var G=u(d,2),S=n(G),x=n(S);x.__click=[Zt,rt,a];var ut=n(x);Ut(ut),s(x);var M=u(x,2),dt=n(M,!0);s(M);var q=u(M,2);q.__click=[te,L,a];var pt=n(q);Yt(pt),s(q),s(S);var Y=u(S,2),E=n(Y);E.__click=[ee,L,a];var A=u(E,2);A.__click=[ae,at,a];var vt=n(A);V(vt),s(A),s(Y),s(G),s(l),xt(ft=>{_=Ct(l,1,"flex-row flex-end vertically-centered",null,_,ft),H(ct,t(a).title||"<missing title>"),H(dt,t(i)[t(a).url]||0)},[()=>({selected:(t(i)[t(a).url]||0)>0})]),Pt(3,l,()=>Rt),w(e,l)}),s(z),s(C);var nt=u(C,2);{var _t=e=>{It(e,{click:()=>{p(f,null)},content:l=>{var _=se(),d=J(_);d.__click=[ie,f];var k=n(d);zt(k),s(d);var y=u(d,2);Kt(y,{get recipe(){return t(f)},show_colors:!0}),w(l,_)},$$slots:{content:!0}})};wt(nt,e=>{t(f)&&e(_t)})}w(o,N),yt(),W()}bt(["click"]);export{Re as component};
