import{n as mt,a as w,d as bt,t as O,s as H}from"../chunks/aHhSpOdM.js";import{p as gt,l as b,m as I,o as t,q as p,D as ht,f as J,c as n,u as kt,s as u,a as yt,z as j,r as i,t as xt}from"../chunks/BYTqjnmQ.js";import{s as K}from"../chunks/Ci9CMcXt.js";import{i as wt}from"../chunks/DZ2x0wit.js";import{e as $t}from"../chunks/CLXJqfNh.js";import{s as Ct}from"../chunks/BFw_Zomu.js";import{t as Pt,s as Rt}from"../chunks/SGeIRAAh.js";import{b as St,s as qt,a as Q}from"../chunks/BwSmt7X6.js";import{j as Mt,s as U,g as At,a as jt,b as Dt}from"../chunks/CylpzTi1.js";import{j as D,f as Ot,s as Ft,k as Lt,h as Nt,c as Tt,a as zt}from"../chunks/64BZPr2v.js";import{C as Bt}from"../chunks/Cyt5gH4l.js";import{M as Yt}from"../chunks/C63kc6XK.js";import"../chunks/DbO4ygGo.js";import{P as Et}from"../chunks/Dkegijom.js";import{R as V}from"../chunks/DaXXVVZ7.js";import{S as Gt}from"../chunks/CX_2_5jC.js";import{T as Ht}from"../chunks/CpgGpn1j.js";import{O as It}from"../chunks/Yh1PSW4n.js";import{R as Jt}from"../chunks/BJN1SkyU.js";import{R as Kt}from"../chunks/CJPo3_SQ.js";var Qt=mt('<svg viewBox="0 -12 32 32" width="16px" height="16px" style="min-width: 16px" fill="#ffffff"><g transform="translate(-414.000000, -1049.000000)" fill="#ffffff"><path d="M442,1049 L418,1049 C415.791,1049 414,1050.79 414,1053 C414,1055.21 415.791,1057 418,1057 L442,1057 C444.209,1057 446,1055.21 446,1053 C446,1050.79 444.209,1049 442,1049"></path></g></svg>');function Ut(o){var r=Qt();w(o,r)}function Vt(o,r){p(r,{},!0)}var Wt=(o,r)=>{jt(t(r).id),Tt("/shopping-lists")},Xt=(o,r,c)=>{o.stopPropagation(),p(r,t(c),!0)},Zt=(o,r,c)=>{o.stopPropagation(),r(t(c))},te=(o,r,c)=>{o.stopPropagation(),r(t(c))},ee=(o,r,c)=>{o.stopPropagation(),r(t(c),.5)},ae=(o,r,c)=>{o.stopPropagation(),r(t(c),0)},re=O('<div><button class="grow vertically-centered gap1 white-text" title="See preview" aria-label="See preview"><!> <h2> </h2></button> <div class="shrink flex-col centered"><div class="shrink vertically-centered"><button title="Add to list" aria-label="Add to list"><!></button> <b title="Count" aria-label="Count"> </b> <button title="Add to list" aria-label="Add to list"><!></button></div> <div class="shrink vertically-centered justify-center"><button title="Make a half batch" aria-label="Make a half batch">Â½</button> <button title="Reset" aria-label="Reset"><!></button></div></div></div>'),se=(o,r)=>{o.stopPropagation(),p(r,null)},ie=O('<button class="close-button svelte-48x7r2" title="Close" aria-label="Close"><!></button> <!>',1),oe=O('<div class="card has-list gap1 flex-col pt0"><div class="flex-row wrap gap1 p0 pt0_5 flex-end"><button class="blue rounded icon-button ph0"><!> Reset</button> <button class="red rounded icon-button p0_5"><!> Delete list</button> <h3 class="vertically-centered rounded ph0 icon-button"><!> Autosaved</h3></div> <div class="rounded-bottom black p0_5 pt2"><!></div> <div class="list"></div></div> <!>',1);function Re(o,r){gt(r,!0);const[c,W]=qt(),F=()=>Q(D,"$current_list_name",c),X=()=>Q(zt,"$all_recipes",c);D.set(Z());function Z(){const e=new Date,a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0");return`${l}-${_}-${a} list`}let $=b(I([])),s=b(I({})),f=b(null),v=b(void 0),m=kt(()=>({id:t(v),name:F()||"",items:et(),checked_items:{}})),L=b(!1);tt();async function tt(){if(t(L))return;p(L,!0);let e=Ot("id");if(Number(e)===-1)p(v,await Mt(K(t(m))),!0),U(t(v)),t(v)!=null?Ft("id",t(v).toString()):Lt("id");else if(Nt(e)){let a=Number(e),l=await At(a);if(l){U(t(v)),p(s,{},!0),St(D,l.name);for(let _ of l.items)t(s)[_.recipe_url]?t(s)[_.recipe_url]+=_.quantity:t(s)[_.recipe_url]=_.quantity;p(v,l.id,!0)}}}ht(()=>{F()&&t(m).id!=null&&t(m).id>=0&&Dt(K(t(m)))});function et(){let e=[];for(let a of Object.keys(t(s)))for(let l of X())if(l.url===a){e.push({recipe_url:l.url,quantity:t(s)[a]});break}return e}function at(e,a){a<=0?delete t(s)[e.url]:t(s)[e.url]=a}function N(e,a=1){t(s)[e.url]?t(s)[e.url]+=a:t(s)[e.url]=a}function rt(e){t(s)[e.url]&&(t(s)[e.url]-=1,t(s)[e.url]<=0&&delete t(s)[e.url])}var T=oe(),C=J(T),P=n(C),g=n(P);g.__click=[Vt,s];var st=n(g);V(st),j(),i(g);var h=u(g,2);h.__click=[Wt,m];var it=n(h);Ht(it),j(),i(h);var z=u(h,2),ot=n(z);Gt(ot),j(),i(z),i(P);var R=u(P,2),lt=n(R);Jt(lt,{get recipes(){return t($)},set recipes(e){p($,e,!0)}}),i(R);var B=u(R,2);$t(B,21,()=>t($),e=>e.url,(e,a)=>{var l=re();let _;var d=n(l);d.__click=[Xt,f,a];var k=n(d);Yt(k);var y=u(k,2),ct=n(y,!0);i(y),i(d);var Y=u(d,2),S=n(Y),x=n(S);x.__click=[Zt,rt,a];var ut=n(x);Ut(ut),i(x);var q=u(x,2),dt=n(q,!0);i(q);var M=u(q,2);M.__click=[te,N,a];var pt=n(M);Et(pt),i(M),i(S);var E=u(S,2),G=n(E);G.__click=[ee,N,a];var A=u(G,2);A.__click=[ae,at,a];var vt=n(A);V(vt),i(A),i(E),i(Y),i(l),xt(ft=>{_=Ct(l,1,"flex-row flex-end vertically-centered",null,_,ft),H(ct,t(a).title||"<missing title>"),H(dt,t(s)[t(a).url]||0)},[()=>({selected:(t(s)[t(a).url]||0)>0})]),Pt(3,l,()=>Rt),w(e,l)}),i(B),i(C);var nt=u(C,2);{var _t=e=>{It(e,{click:()=>{p(f,null)},content:l=>{var _=ie(),d=J(_);d.__click=[se,f];var k=n(d);Bt(k),i(d);var y=u(d,2);Kt(y,{get recipe(){return t(f)},show_colors:!0}),w(l,_)},$$slots:{content:!0}})};wt(nt,e=>{t(f)&&e(_t)})}w(o,T),yt(),W()}bt(["click"]);export{Re as component};
